#include <NewPing.h>
#define L_InPin_1  2  //왼쪽모터 핀1
#define L_InPin_2  3  //왼쪽모터 핀2
#define R_InPin_1  7  //오른쪽모터 핀1
#define R_InPin_2  4  //오른쪽모터 핀2
#define L_en  5 //왼쪽모터 속도 제어 핀
#define R_en  6 //오른쪽모터 속도 제어 핀
#define F_Sonar  8  //정면부 초음파 센서 연결 핀
#define R_Sonar  10 //오른쪽 초음파 센서 연결 핀
#define L_Sonar  11 //왼쪽 초음파 센서 연결 핀
#define MaxDistance  150

float R_sonar_Distance = 0.0;
float R_sonar_Distance_old = 0.0;
float R_sonar_Error = 0.0;

float L_sonar_Distance = 0.0;
float L_sonar_Distance_old = 0.0;
float L_sonar_Error = 0.0;

float F_sonar_Distance = 0.0;
float F_sonar_Distance_old = 0.0;
float F_sonar_Error = 0.0;

NewPing F_sensor(F_Sonar,F_Sonar,MaxDistance);
NewPing R_sensor(R_Sonar,R_Sonar,MaxDistance);
NewPing L_sensor(L_Sonar,L_Sonar,MaxDistance);

void read_sonar_sensor(void) //초음파 센서 값을 읽는 함수
{
   R_sonar_Distance = R_sensor.ping_cm()*10.; //각자에 맞도록 센서 번호 설정
   L_sonar_Distance = L_sensor.ping_cm()*10.;
   F_sonar_Distance = F_sensor.ping_cm()*10.;
   if( R_sonar_Distance == 0) R_sonar_Distance = MaxDistance * 10.0;
   if( L_sonar_Distance == 0) L_sonar_Distance = MaxDistance * 10.0;
   if( F_sonar_Distance == 0) F_sonar_Distance = MaxDistance * 10.0;
}
void updata_sonar_old(void)
{
 R_sonar_Distance_old =  R_sonar_Distance;
 L_sonar_Distance_old =  L_sonar_Distance;
 F_sonar_Distance_old =  F_sonar_Distance;
}

void updata_sonar_error(void)
{
 R_sonar_Error =  R_sonar_Distance -  R_sonar_Distance_old;
 L_sonar_Error =  L_sonar_Distance -  L_sonar_Distance_old;
 F_sonar_Error =  F_sonar_Distance -  F_sonar_Distance_old;
}
void setup() {
  // put your setup code here, to run once:
Serial.begin(115200);


}

void loop() {
  // put your main code here, to run repeatedly:
 read_sonar_sensor();
 updata_sonar_error();
 updata_sonar_old();
 Serial.print(R_sonar_Error); Serial.print("\t ");
 Serial.print(L_sonar_Error); Serial.print("\t ");
 Serial.println(F_sonar_Error);
 delay(250);
 
 
 
}
